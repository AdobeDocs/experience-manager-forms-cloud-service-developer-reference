(self.webpackChunkexperience_manager_forms_cloud_service=self.webpackChunkexperience_manager_forms_cloud_service||[]).push([[776],{1776:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return M}});var o,r,i,c,a,u=t(5007),s=t(5444),l=t(2036);!function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(o||(o={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(r||(r={})),function(e){e.ConnectionDestroyed="ConnectionDestroyed",e.ConnectionTimeout="ConnectionTimeout",e.NoIframeSrc="NoIframeSrc"}(i||(i={})),function(e){e.DataCloneError="DataCloneError"}(c||(c={})),function(e){e.Message="message"}(a||(a={}));var d={"http:":"80","https:":"443"},f=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,g=["file:","data:"],v=function(e){return{name:e.name,message:e.message,stack:e.stack}},m=function(e){var n=new Error;return Object.keys(e).forEach((function(t){return n[t]=e[t]})),n},h=0,p=function(){return++h},y=function(e){return e?e.split("."):[]},w=function(e,n,t){var o=y(n);return o.reduce((function(e,n,r){return void 0===e[n]&&(e[n]={}),r===o.length-1&&(e[n]=t),e[n]}),e),e},E=function e(n,t){var o={};return Object.keys(n).forEach((function(r){var i=n[r],c=function(e,n){var t=y(n||"");return t.push(e),function(e){return e.join(".")}(t)}(r,t);"object"==typeof i&&Object.assign(o,e(i,c)),"function"==typeof i&&(o[c]=i)})),o},S=function(e,n,t,c,u){var s=n.localName,l=n.local,d=n.remote,f=n.originForSending,g=n.originForReceiving,v=!1;u("".concat(s,": Connecting call sender"));var h=t.reduce((function(e,n){var t;return e[n]=(t=n,function(){for(var e=arguments.length,n=new Array(e),h=0;h<e;h++)n[h]=arguments[h];var y;u("".concat(s,": Sending ").concat(t,"() call"));try{d.closed&&(y=!0)}catch(E){y=!0}if(y&&c(),v){var w=new Error("Unable to send ".concat(t,"() call due ")+"to destroyed connection");throw w.code=i.ConnectionDestroyed,w}return new Promise((function(e,i){var c=p();l.addEventListener(a.Message,(function n(f){if(f.source===d&&f.data.penpal===o.Reply&&f.data.id===c)if("*"===g||f.origin===g){var v=f.data;u("".concat(s,": Received ").concat(t,"() reply")),l.removeEventListener(a.Message,n);var h=v.returnValue;v.returnValueIsError&&(h=m(h)),(v.resolution===r.Fulfilled?e:i)(h)}else u("".concat(s," received message from origin ").concat(f.origin," which did not match expected origin ").concat(g))}));var v={penpal:o.Call,id:c,methodName:t,args:n};d.postMessage(v,f)}))}),e}),{});return Object.assign(e,function(e){var n={};for(var t in e)w(n,t,e[t]);return n}(h)),function(){v=!0}},k=function(e,n,t,i,u){var s,l,d=i.destroy,f=i.onDestroy,g={};return function(i){if("*"===n||i.origin===n){u("Parent: Handshake - Received ACK");var m={localName:"Parent",local:window,remote:i.source,originForSending:t,originForReceiving:n};s&&s(),s=function(e,n,t){var i=e.localName,u=e.local,s=e.remote,l=e.originForSending,d=e.originForReceiving,f=!1,g=function(e){if(e.source===s&&e.data.penpal===o.Call)if("*"===d||e.origin===d){var a=e.data,u=a.methodName,g=a.args,m=a.id;t("".concat(i,": Received ").concat(u,"() call"));var h=function(e){return function(n){if(t("".concat(i,": Sending ").concat(u,"() reply")),f)t("".concat(i,": Unable to send ").concat(u,"() reply due to destroyed connection"));else{var a={penpal:o.Reply,id:m,resolution:e,returnValue:n};e===r.Rejected&&n instanceof Error&&(a.returnValue=v(n),a.returnValueIsError=!0);try{s.postMessage(a,l)}catch(g){if(g.name===c.DataCloneError){var d={penpal:o.Reply,id:m,resolution:r.Rejected,returnValue:v(g),returnValueIsError:!0};s.postMessage(d,l)}throw g}}}};new Promise((function(e){return e(n[u].apply(n,g))})).then(h(r.Fulfilled),h(r.Rejected))}else t("".concat(i," received message from origin ").concat(e.origin," which did not match expected origin ").concat(d))};return u.addEventListener(a.Message,g),function(){f=!0,u.removeEventListener(a.Message,g)}}(m,e,u),f(s),l&&l.forEach((function(e){delete g[e]})),l=i.data.methodNames;var h=S(g,m,l,d,u);return f(h),g}u("Parent: Handshake - Received ACK message from origin ".concat(i.origin," which did not match expected origin ").concat(n))}},C=function(e){var n=e.iframe,t=e.methods,r=void 0===t?{}:t,c=e.childOrigin,u=e.timeout,s=e.debug,l=function(e){return function(){if(e){for(var n,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];(n=console).log.apply(n,["[Penpal]"].concat(o))}}}(void 0!==s&&s),v=function(e,n){var t=[],o=!1;return{destroy:function(r){o||(o=!0,n("".concat(e,": Destroying connection")),t.forEach((function(e){e(r)})))},onDestroy:function(e){o?e():t.push(e)}}}("Parent",l),m=v.onDestroy,h=v.destroy;c||(!function(e){if(!e.src&&!e.srcdoc){var n=new Error("Iframe must have src or srcdoc property defined.");throw n.code=i.NoIframeSrc,n}}(n),c=function(e){if(e&&g.find((function(n){return e.startsWith(n)})))return"null";var n,t,o,r=document.location,i=f.exec(e);i?(n=i[1]?i[1]:r.protocol,t=i[2],o=i[4]):(n=r.protocol,t=r.hostname,o=r.port);var c=o&&o!==d[n]?":".concat(o):"";return"".concat(n,"//").concat(t).concat(c)}(n.src));var p="null"===c?"*":c,y=E(r),w=function(e,n,t,r){return function(i){if("*"===t||i.origin===t){e("Parent: Handshake - Received SYN, responding with SYN-ACK");var c={penpal:o.SynAck,methodNames:Object.keys(n)};i.source.postMessage(c,r)}else e("Parent: Handshake - Received SYN message from origin ".concat(i.origin," which did not match expected origin ").concat(t))}}(l,y,c,p),S=k(y,c,p,v,l);return{promise:new Promise((function(e,t){var r=function(e,n){var t;return void 0!==e&&(t=window.setTimeout((function(){var t=new Error("Connection timed out after ".concat(e,"ms"));t.code=i.ConnectionTimeout,n(t)}),e)),function(){clearTimeout(t)}}(u,h),c=function(t){if(t.source===n.contentWindow&&t.data)if(t.data.penpal!==o.Syn)if(t.data.penpal!==o.Ack);else{var i=S(t);i&&(r(),e(i))}else w(t)};window.addEventListener(a.Message,c),l("Parent: Awaiting handshake"),function(e,n){var t=n.destroy,o=n.onDestroy,r=setInterval((function(){e.isConnected||(clearInterval(r),t())}),6e4);o((function(){clearInterval(r)}))}(n,v),m((function(e){window.removeEventListener(a.Message,c),e&&t(e)}))})),destroy:function(){h()}}},R=t(8094),I=t(7791),b=t(2390),M=function(e){var n=e.src,t=e.height,o=void 0===t?"calc(100vh - var(--spectrum-global-dimension-size-800))":t,r=e.location,i=(0,u.useRef)(null),c=(0,u.useContext)(I.Z).ims,a=(0,u.useState)(null),d=a[0],f=a[1];return(0,u.useEffect)((function(){d&&(0===i.current.clientHeight?d.onHide():d.onShow())}),[r.pathname]),(0,l.tZ)(u.default.Fragment,null,(0,l.tZ)("iframe",{title:"Main content",ref:i,src:(0,b.Bm)(n)?n:(0,s.dq)(n),onLoad:function(){C({iframe:i.current,methods:{scrollTop:function(e){var n;void 0===e&&(e=0),null!==(n=document)&&void 0!==n&&n.scrollingElement&&(document.scrollingElement.scrollTop=e)},getURL:function(){var e,n;return null===(e=window)||void 0===e||null===(n=e.location)||void 0===n?void 0:n.href},setURL:function(e){var n;null!==(n=window)&&void 0!==n&&n.location&&(window.location=e)},setHeight:function(e){i.current.style.height=e},getIMSAccessToken:function(){return null!=c&&c.isSignedInUser()?c.getAccessToken():null},getIMSProfile:function(){return null!=c&&c.isSignedInUser()?c.getProfile():null},signIn:function(){c&&!c.isSignedInUser()&&c.signIn()},signOut:function(){c&&c.isSignedInUser()&&c.signOut()}}}).promise.then((function(e){0===i.current.clientHeight?e.onHide():e.onShow(),f(e)}))},css:(0,l.iv)("display:block;height:",o,";width:100%;border:none;","")}),(0,l.tZ)(R.$,null))}}}]);
//# sourceMappingURL=776-dae1315bed524e1fc469.js.map